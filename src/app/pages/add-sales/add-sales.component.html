<!-- add-sales.page.html -->
<ion-content class="add-sales-content" fullscreen>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <button class="back-btn" (click)="goBack()">
        <ion-icon name="arrow-back"></ion-icon>
      </button>
            <h1 class="page-title">Add Sales</h1>
            <div class="header-actions">
                <button class="save-btn" (click)="saveSale()" [disabled]="!canSave()">
          Save
        </button>
            </div>
        </div>
    </div>

    <!-- Info Banner -->
    <div class="info-banner">
        <div class="info-icon">
            <ion-icon name="information-circle"></ion-icon>
        </div>
        <div class="info-content">
            <p class="info-title">Recording Tips</p>
            <p class="info-text">
                <strong>Recommended:</strong> Record sales as they happen for accurate tracking. You can also record daily totals at the end of the day.
            </p>
        </div>
    </div>

    <!-- Main Form -->
    <div class="form-container">
        <!-- Amount Input -->
        <div class="input-group">
            <label class="input-label">Amount (GHS) *</label>
            <div class="amount-input-container">
                <span class="currency-symbol">GHS</span>
                <input type="number" class="amount-input" placeholder="0.00" [(ngModel)]="saleData.amount" (input)="validateAmount()" autofocus>
            </div>
            <div class="input-error" *ngIf="showAmountError">
                Please enter a valid amount
            </div>
        </div>

        <!-- Quick Amount Buttons -->
        <div class="quick-amounts">
            <button *ngFor="let amount of quickAmounts" class="quick-amount-btn" (click)="setQuickAmount(amount)" [class.active]="saleData.amount === amount">
        GHS {{amount}}
      </button>
        </div>

        <!-- DateTime -->
        <div class="input-group">
            <label class="input-label">Date & Time</label>
            <div class="datetime-display" (click)="showDateTimePicker()">
                <ion-icon name="calendar"></ion-icon>
                <span class="datetime-text">{{saleData.datetime | date:'MMM d, y - h:mm a'}}</span>
                <ion-icon name="chevron-down" class="chevron"></ion-icon>
            </div>
        </div>

        <!-- Customer -->
        <div class="input-group">
            <label class="input-label">Customer (Optional)</label>
            <input type="text" class="text-input" placeholder="Customer name or type" [(ngModel)]="saleData.customer">
        </div>

        <!-- Category -->
        <div class="input-group">
            <label class="input-label">Category (Optional)</label>
            <div class="category-select" (click)="showCategoryPicker()">
                <span class="category-text">
          {{saleData.category || 'Select category'}}
        </span>
                <ion-icon name="chevron-down" class="chevron"></ion-icon>
            </div>
        </div>

        <!-- Notes -->
        <div class="input-group">
            <label class="input-label">Notes (Optional)</label>
            <textarea class="notes-input" placeholder="Add any notes about this sale..." [(ngModel)]="saleData.notes" rows="3"></textarea>
        </div>

        <!-- Recent Sales Quick Add -->
        <div class="recent-sales" *ngIf="recentSales.length > 0">
            <h3 class="section-title">Quick Add from Recent</h3>
            <div class="recent-sales-list">
                <div *ngFor="let recent of recentSales" class="recent-sale-item" (click)="fillFromRecent(recent)" (swipe)="onSwipeRecent($event, recent)">
                    <div class="recent-amount">GHS {{recent.amount}}</div>
                    <div class="recent-details">
                        <span class="recent-customer" *ngIf="recent.customer">{{recent.customer}}</span>
                        <span class="recent-time">{{getTimeAgo(recent.datetime)}}</span>
                    </div>
                    <div class="swipe-action">Fill</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action for Quick Save -->
    <button class="fab-save" (click)="quickSave()" [class.active]="canSave()">
    <ion-icon name="checkmark"></ion-icon>
  </button>
</ion-content>

<!-- Category Picker Modal -->
<ion-modal [isOpen]="showCategoryModal" (didDismiss)="showCategoryModal = false">
    <ng-template>
        <ion-header>
            <ion-toolbar class="select-category">
                <ion-title>Select Category</ion-title>
                <ion-buttons slot="end">
                    <ion-button (click)="showCategoryModal = false">Close</ion-button>
                </ion-buttons>
            </ion-toolbar>
        </ion-header>
        <ion-content class="select-category">
            <div class="category-options">
                <button *ngFor="let category of categories" class="category-option" (click)="selectCategory(category)" [class.selected]="saleData.category === category">
          {{category}}
        </button>
            </div>
        </ion-content>
    </ng-template>
</ion-modal>